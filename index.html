<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Pickleball Court Snapshot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body{background:#222;color:#fff;font-family:system-ui,Arial;margin:0;text-align:center}
    header{padding:16px 12px 0}
    .meta{color:#bbb;font-size:14px;margin:6px 0 18px}
    img{width:90%;max-width:1400px;height:auto;border:4px solid #444;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.35)}
    .row{display:flex;gap:12px;justify-content:center;align-items:center;margin:12px 0 24px}
    .pill{background:#222;border:1px solid #444;border-radius:999px;padding:6px 12px}
    a{color:#8fd3ff;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0 0 8px">Memorial Park Pickleball Court</h1>
    <div class="row">
      <div class="pill">Next refresh in: <span id="count">--:--</span></div>
    </div>
  </header>

  <img id="snap" src="snapshot.jpg" alt="Latest snapshot">
  
   <header>
    <div class="meta">Image is automatically updates every 2 minutes.</div>
  </header>

  <script>
    // ======= settings =======
    const PUBLISH_INTERVAL_MS = 120000; // 2 minutes (change to 60000 if you move timer to every 1 min)
    const IMAGE_REFRESH_MS   = 30000;   // refresh the <img> every 30s
    // ========================

    const snap = document.getElementById('snap');
    const lastModEl = document.getElementById('lastMod');
    const countEl = document.getElementById('count');

    // format mm:ss
    function fmt(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const ss = (s%60).toString().padStart(2,'0');
      return `${m}:${ss}`;
    }

    // fetch Last-Modified header and show it
    async function updateLastModified(){
      try{
        const head = await fetch('snapshot.jpg?head=' + Date.now(), { method: 'HEAD', cache: 'no-store' });
        const lm = head.headers.get('Last-Modified');
        if(lm){
          const d = new Date(lm);
          lastModEl.textContent = d.toLocaleString();
          // reset countdown anchored to last-modified time
          nextTickTarget = d.getTime() + PUBLISH_INTERVAL_MS;
        }
      }catch(e){ /* ignore */ }
    }

    // keep the image fresh
    function refreshImage(){
      snap.src = 'snapshot.jpg?t=' + Date.now();
      updateLastModified();
    }

    // countdown
    let nextTickTarget = Date.now() + PUBLISH_INTERVAL_MS;
    setInterval(() => {
      const remaining = nextTickTarget - Date.now();
      countEl.textContent = fmt(remaining);
      if (remaining <= 0) {
        nextTickTarget = Date.now() + PUBLISH_INTERVAL_MS;
        // also refresh image when countdown hits zero (in case a new publish just landed)
        refreshImage();
      }
    }, 1000);

    // kick things off
    refreshImage();                       // immediate
    setInterval(refreshImage, IMAGE_REFRESH_MS);  // every 30s
    
  </script>
</body>
</html>

